{% extends 'school/base.html' %}
{% load static i18n %}

{% block content %}
<div class="content-wrapper">
    <!-- Content Header -->
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1 class="m-0">{% trans "Dashboard" %}</h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="{% url 'school:dashboard' %}">{% trans "Ana Səhifə" %}</a></li>
                        <li class="breadcrumb-item active">{% trans "Dashboard" %}</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- Main content -->
    <section class="content">
        <div class="container-fluid">
            <!-- Info boxes -->
            <div class="row">
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="info-box">
                        <span class="info-box-icon bg-info elevation-1">
                            <i class="fas fa-user-graduate"></i>
                        </span>
                        <div class="info-box-content">
                            <span class="info-box-text">{% trans "Şagird sayı" %}</span>
                            <span class="info-box-number">{{ total_students }}</span>
                        </div>
                    </div>
                </div>
                
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="info-box">
                        <span class="info-box-icon bg-success elevation-1">
                            <i class="fas fa-chalkboard-teacher"></i>
                        </span>
                        <div class="info-box-content">
                            <span class="info-box-text">{% trans "Müəllim sayı" %}</span>
                            <span class="info-box-number">{{ total_teachers }}</span>
                        </div>
                    </div>
                </div>
                
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="info-box">
                        <span class="info-box-icon bg-warning elevation-1">
                            <i class="fas fa-clipboard-check"></i>
                        </span>
                        <div class="info-box-content">
                            <span class="info-box-text">{% trans "Bu günkü davamiyyət" %}</span>
                            <span class="info-box-number">{{ today_attendance_percent }}%</span>
                        </div>
                    </div>
                </div>
                
                <div class="col-12 col-sm-6 col-md-3">
                    <div class="info-box">
                        <span class="info-box-icon bg-danger elevation-1">
                            <i class="fas fa-star"></i>
                        </span>
                        <div class="info-box-content">
                            <span class="info-box-text">{% trans "Orta qiymət" %}</span>
                            <span class="info-box-number">{{ average_grade }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- Attendance Chart -->
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">{% trans "Son 7 günün davamiyyəti" %}</h3>
                        </div>
                        <div class="card-body">
                            <canvas id="attendanceChart" style="min-height: 250px;"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Grade Chart -->
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">{% trans "Qiymət statistikası" %}</h3>
                        </div>
                        <div class="card-body">
                            <canvas id="gradesChart" style="min-height: 250px;"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- Recent Attendance -->
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">{% trans "Son davamiyyətlər" %}</h3>
                        </div>
                        <div class="card-body p-0">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>{% trans "Tarix" %}</th>
                                        <th>{% trans "Şagird" %}</th>
                                        <th>{% trans "Status" %}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for attendance in recent_attendances %}
                                    <tr>
                                        <td>{{ attendance.date }}</td>
                                        <td>{{ attendance.student.get_full_name }}</td>
                                        <td>
                                            {% if attendance.is_present %}
                                            <span class="badge badge-success">{% trans "İştirak edir" %}</span>
                                            {% else %}
                                            <span class="badge badge-danger">{% trans "İştirak etmir" %}</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Recent Grades -->
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">{% trans "Son qiymətlər" %}</h3>
                        </div>
                        <div class="card-body p-0">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>{% trans "Tarix" %}</th>
                                        <th>{% trans "Şagird" %}</th>
                                        <th>{% trans "Fənn" %}</th>
                                        <th>{% trans "Qiymət" %}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for grade in recent_grades %}
                                    <tr>
                                        <td>{{ grade.date }}</td>
                                        <td>{{ grade.student.get_full_name }}</td>
                                        <td>{{ grade.subject }}</td>
                                        <td>{{ grade.grade }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script>
$(document).ready(function() {
    // Attendance Chart
    var attendanceCtx = document.getElementById('attendanceChart').getContext('2d');
    new Chart(attendanceCtx, {
        type: 'line',
        data: {
            labels: {{ last_7_days|safe }},
            datasets: [{
                label: '{% trans "Davamiyyət %" %}',
                data: {{ attendance_data|safe }},
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    suggestedMax: 100
                }
            }
        }
    });

    // Grades Chart
    var gradesCtx = document.getElementById('gradesChart').getContext('2d');
    new Chart(gradesCtx, {
        type: 'bar',
        data: {
            labels: ['2', '3', '4', '5'],
            datasets: [{
                label: '{% trans "Qiymət sayı" %}',
                data: [0, 0, 0, 0],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(255, 205, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(54, 162, 235, 0.2)'
                ],
                borderColor: [
                    'rgb(255, 99, 132)',
                    'rgb(255, 205, 86)',
                    'rgb(75, 192, 192)',
                    'rgb(54, 162, 235)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
});
</script>
{% endblock %}
